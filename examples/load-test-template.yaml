apiVersion: locust.cloud/v1
kind: LocustTest
metadata:
  name: pvc-reuse-${CLUSTER_NAME}
  namespace: locust
spec:
  # have to use a custom image due to additional dependencies
  # image: locustio/locust:2.42.1
  image: ${ECR_URL}/locust:latest
  imagePullPolicy: IfNotPresent
  workers: 2
  # run locust-provision.sh to replaces env variables
  # or manually change by actual values
  env:
  - name: AWS_REGION
    value: ${REGION}
  - name: CLUSTER_NAME
    value: ${CLUSTER_NAME}
  - name: JOB_SCRIPT_NAME
    value: ${JOB_SCRIPT_NAME}
  - name: SPARK_JOB_NS_NUM
    value: 5
  extraArgs:
    -f /home/locust/locustfile.py
    --job-azs '["${REGION}a","${REGION}b"]'
    --run-time=60m
    --users=300
    --spawn-rate=.5
    --skip-log-setup
  locustfile:
    configMap:
      name: emr-loadtest-locustfile
  master:
    resources:
      requests:
        cpu: "500m"
        memory: "512Mi"
      limits:
        cpu: "2"
        memory: "2Gi"
  worker:
    resources:
      requests:
        cpu: "1"
        memory: "1Gi"
      limits:
        cpu: "8"
        memory: "8Gi"